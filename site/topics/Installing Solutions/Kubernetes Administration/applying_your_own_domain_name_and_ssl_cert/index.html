<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>Domains & Certificates - SoFy Docs</title>
        <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../..">SoFy Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../../.." class="nav-link">Welcome</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../../about/" class="nav-link">About</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Topics <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Installing Solutions</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../" class="dropdown-item">Installing Solutions</a>
</li>
            
<li>
    <a href="../../using_new_gcp_trial_account/" class="dropdown-item">Quick Start - GCP Trial</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Kubernetes Administration</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../" class="dropdown-item">Kubernetes Administration</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Domains & Certificates</a>
</li>
            
<li>
    <a href="../installing_solutions_step_by_step_instructions/" class="dropdown-item">Install Step-By-Step</a>
</li>
            
<li>
    <a href="../setting_up_flexnet/" class="dropdown-item">FlexNet Licensing</a>
</li>
            
<li>
    <a href="../supported_kubernetes_environments/" class="dropdown-item">Supported Environments</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Solution Overview</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../Solution%20Overview/" class="dropdown-item">Solution Overview</a>
</li>
            
<li>
    <a href="../../../Solution%20Overview/sofy_common_services/" class="dropdown-item">SoFy Common Services</a>
</li>
            
<li>
    <a href="../../../Solution%20Overview/solution-overview/" class="dropdown-item">What is a Solution?</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Using Solutions</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../Using%20Solutions/" class="dropdown-item">Using Solutions</a>
</li>
            
<li>
    <a href="../../../Using%20Solutions/accessing_solutions_programmatically/" class="dropdown-item">Accessing Programmatically</a>
</li>
            
<li>
    <a href="../../../Using%20Solutions/default_login_credentials/" class="dropdown-item">Default Credentials</a>
</li>
            
<li>
    <a href="../../../Using%20Solutions/managing_solution_users/" class="dropdown-item">Managing User Access</a>
</li>
            
<li>
    <a href="../../../Using%20Solutions/sofy_software_offerings/" class="dropdown-item">Software Offerings</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../installing_solutions_step_by_step_instructions/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#applying-a-domain-and-ssl-certificate-to-your-solution" class="nav-link">Applying a Domain and SSL Certificate to Your Solution</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#i-configure-your-domain-name-and-dns-zone" class="nav-link">I. Configure your domain name and DNS zone</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ii-create-a-gcp-service-account-with-the-dns-administrator-role" class="nav-link">II. Create a GCP service account with the DNS administrator role</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#iii-create-a-kubernetes-secret-with-the-service-account-credentials" class="nav-link">III. Create a Kubernetes secret with the service account credentials</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#iv-configure-your-solution-to-use-the-domain-name-and-to-request-certificate-generation-at-install" class="nav-link">IV. Configure your solution to use the domain name and to request certificate generation at install</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#v-access-your-solution-using-the-domain-name-and-validiate-the-certificate" class="nav-link">V. Access your solution using the domain name and validiate the certificate</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="applying-a-domain-and-ssl-certificate-to-your-solution"><strong>Applying a Domain and SSL Certificate to Your Solution</strong></h1>
<p>By default, a SoFy Solution will create its own self signed SSL certificate. This is meant for initial development and testing and will throw many warnings and cause issues on most HTTP clients, including browsers and some of the most common programmatic client libraries. There are options to apply your own domain name and a recognized SSL certificate to a solution; these quick start instructions will describe the simpler method, using the Let's Encrypt service to dynamically generate a certificate.  </p>
<p>You will need the following prerequisites:</p>
<ul>
<li>A cluster in GCP configured to run a solution</li>
<li>A domain name, for example one purchased from https://domains.google.com/</li>
</ul>
<p>This document will go through the following steps:
*  Configuring your domain name and DNS zone
*  Creating a GCP service account with the DNS Administrator role
*  Creating a Kubernetes secret with the service account credentials
*  Configuring your solution to use the domain name and request certificate generation at install
*  Accessing your solution using the domain name and validating the certificate</p>
<hr />
<h2 id="i-configure-your-domain-name-and-dns-zone"><strong>I. Configure your domain name and DNS zone</strong></h2>
<ol>
<li>Log into your GCP account at https://console.cloud.google.com.</li>
<li>Navigate to <strong>Network Services</strong> &gt; <strong>Cloud DNS</strong> and click <strong>Create Zone</strong>.</li>
<li>Enter a name for the zone and your domain name in 'DNS name' then click <strong>create</strong>.</li>
<li>When you click on the newly created zone, you will see a list of DNS servers, which need to be copied into your domain name configuration.</li>
<li>Log into https://domains.google.com; in 'My Domains' click on the domain name that you are using for the solution.</li>
<li>Navigate to <strong>DNS</strong> then select <strong>Use custom name servers</strong>.</li>
<li>Cut and paste the DNS servers (one at a time, do not include the trailing '.') from the GCP Cloud DNS page to the Google domain name entry, then save.</li>
</ol>
<hr />
<h2 id="ii-create-a-gcp-service-account-with-the-dns-administrator-role"><strong>II. Create a GCP service account with the DNS administrator role</strong></h2>
<ol>
<li>Log into your GCP trial account at https://console.cloud.google.com.</li>
<li>Navigate to <strong>IAM &amp; Admin</strong> &gt; <strong>Service Accounts</strong> and click on <strong>Create service account</strong>.</li>
<li>Choose a name for the service account and ID (or accept the default ID); make a note of your service ID.</li>
<li>In the menu of roles, find <strong>DNS</strong> and select <strong>DNS Administrator</strong>, then continue.</li>
<li>Click on <strong>Create key</strong> and select <strong>JSON</strong>. The key will be generated - download to your local machine.</li>
<li>Find the downloaded key file and rename it to "credentials.json," then upload that file to your GCP Cloud Shell.</li>
</ol>
<hr />
<h2 id="iii-create-a-kubernetes-secret-with-the-service-account-credentials"><strong>III. Create a Kubernetes secret with the service account credentials</strong></h2>
<pre><code>kubectl create secret generic gcp-service-account-secret --from-file=./credentials.json
</code></pre>
<hr />
<h2 id="iv-configure-your-solution-to-use-the-domain-name-and-to-request-certificate-generation-at-install"><strong>IV. Configure your solution to use the domain name and to request certificate generation at install</strong></h2>
<p>There are two ways to do this: a) unpack, edit, and then repack the solution Helm chart, or b) use the existing Helm chart but provide the configuration as override on the Helm install command</p>
<p><strong>Option A:</strong> Unpack, edit, and repack the solution Helm chart
1. Untar the solution chart and edit the top-level 'values.yaml' file. Near the top of the file you will see 'global:' and nested under that, 'domain: - edit the value of the domain property to be a subdomain of your domain name, for example:</p>
<pre><code class="language-yaml">global:
  domain: &quot;sol1.alexmul.dev&quot;
</code></pre>
<ol>
<li>Search for the <em>certificate:</em> property in the same file, and add/edit these values. The GCP project ID can be seen by clicking the down-arrow next to your project name in the GCP console.  </li>
</ol>
<pre><code class="language-yaml">certificate:
  type: &quot;production&quot;
  email: ${YOUR_GCP_ACCOUNT_EMAIL}
  dns:
    type: &quot;clouddns&quot;
    project: ${YOUR_GCP_PROJECT_ID}  
    serviceAccountSecretRef:
      name: ${YOUR_GCP_SERVICE_ACCOUNT_SECRET_NAME}
      key: &quot;credentials.json&quot;
</code></pre>
<p>for example,</p>
<pre><code class="language-yaml">certificate:
  type: &quot;production&quot;
  email: &quot;sofy.mulholland@gmail.com&quot;
  existingCertificateSecret: &quot;&quot;
  dns:
    type: &quot;clouddns&quot;
    project: &quot;dark-airway-256814&quot;
    region: &quot;&quot;
    accessKeyID: &quot;&quot;
    serviceAccountSecretRef:
      name: &quot;gcp-service-account-secret&quot;
      key: &quot;credentials.json&quot;
</code></pre>
<ol>
<li>
<p>Optional: Edit the top-level <em>chart.yaml</em> file and increment the version number of the chart. It is a best practice to increment the version number when any change is made to the Helm chart.</p>
</li>
<li>
<p>Repackage the Helm chart with the <em>Helm package</em> command.  </p>
</li>
<li>
<p>Install your modified Helm chart:</p>
</li>
</ol>
<p><code>helm install [my-release-name] [my-solution.tgz] --set global.hclImagePullSecret=[secret-name]</code></p>
<p><strong>Option B:</strong> Install your original Helm chart with additional configuration override on the install command, similar to this:</p>
<p><code>helm install udeploy alex-deploy-0.1.0.tgz  --set global.hclImagePullSecret=secret-name,global.hclImagePullSecret=secret-name,global.domain=sol1.alexmul.com,certificate.type=production,certificate.email=sofy.mulholland@hcl.com,certificate.dns.type=clouddns,certificate.dns.project=dark-airway-256814,certificate.dns.serviceAccountSecretRef.name=gcp-service-account-secret,certificate.dns.serviceAccountSecretRef.key=credentials.json</code></p>
<hr />
<h2 id="v-access-your-solution-using-the-domain-name-and-validiate-the-certificate"><strong>V. Access your solution using the domain name and validiate the certificate</strong></h2>
<p>For example:</p>
<pre><code>https://sofy-console.sol1.alexmul.dev
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../js/base.js" defer></script>
        <script src="../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
